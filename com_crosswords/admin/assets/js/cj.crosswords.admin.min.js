var CjCrosswordsAdminFactory = {};

(function($){
	CjCrosswordsAdminFactory.init = function(){
		$('div.btn-group[data-toggle-name]').each(function(){
			var group   = $(this);
		    var field   = group.closest('.controls');
		    var name    = group.attr('data-toggle-name');
		    var hidden  = field.find('input[name="' + name + '"]');
		    
		    $('button', group).each(function(){
		    	var button = $(this);
		    	button.live('click', function(){
		    		hidden.val($(this).val());
		    		group.find('button').attr('class', 'btn');
		    		$(this).addClass($(this).attr('data-toggle-class'));
		    	});

		    	if(button.val() == hidden.val()) {
		    		button.addClass($(this).attr('data-toggle-class'));
		    	}
		    });
		});
	};
	
	CjCrosswordsAdminFactory.init_crosswords = function(){
		$('.btn-change-state').click(function(event){
			event.preventDefault();
			var button = $(this).addClass('btn-progress');
			var state = button.parent().find('.current_state').val();
			state = (state == 1) ? 0 : 1;
			$.ajax({
				url: button.attr('href')+button.parent().find('.state-'+state).val(),
				dataType: 'json',
				data: {'cid': button.closest('tr').find('input[name="crossword_id"]').val()},
				success: function(data, status, xhr, form){
					if(typeof data.error != 'undefined' && data.error.length > 0){
						$('#message-modal').find('.modal-body').html(data.error);
						$('#message-modal').modal('show');
					}else{
						button.toggleClass('btn-success').toggleClass('btn-danger');
						button.find('i').toggleClass('icon-ok').toggleClass('icon-remove');
						button.parent().find('.current_state').val(state);
					}
					button.removeClass('btn-progress');
				}
			});
			return false;
		});
		
		$('.btn-reset').click(function(){
			$(this).closest('.input-append').find('input[type="text"]').val('');
			$(this).closest('form').submit();
		});
	};
	
	CjCrosswordsAdminFactory.init_dashboard = function(){
		$('.btn-change-state').click(function(event){
			event.preventDefault();
			var button = $(this).addClass('btn-progress');
			$.ajax({
				url: button.attr('href'),
				dataType: 'json',
				success: function(data, status, xhr, form){
					if(typeof data.error != 'undefined' && data.error.length > 0){
						$('#message-modal').find('.modal-body').html(data.error);
						$('#message-modal').modal('show');
					}else{
						button.closest('tr').hide('slow');
					}
				}
			});
			return false;
		});
	};
	
})(jQuery);

jQuery(document).ready(function($){
	CjCrosswordsAdminFactory.init();
	var pageid = $('#cjcrosswords_page_id').val();
	if(pageid == 'crosswords') CjCrosswordsAdminFactory.init_crosswords();
	if(pageid == 'dashboard') CjCrosswordsAdminFactory.init_dashboard();
});